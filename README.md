# 多模式信息检索评估

## 项目概述
本项目实现了一个多模式的信息检索系统，结合了关键词检索和向量检索两种方式，并支持静态和动态的权重融合策略。通过对检索结果进行评估，项目可以直观地展示不同检索方式和融合策略的性能差异。

## 主要功能
- **多模式检索**
  - **关键词检索**：使用Whoosh搜索引擎进行关键词匹配，能够快速定位包含特定关键词的文档。
  - **向量检索**：借助OllamaEmbeddings和Milvus向量数据库，实现基于语义的向量检索，提高检索的准确性和相关性。
- **融合策略**
  - **静态融合**：固定向量检索和关键词检索的权重，通过设置参数`static_alpha`来调整两种检索方式的重要性。
  - **动态融合**：根据查询的具体性动态调整向量检索和关键词检索的权重，提高检索效果。
- **评估指标**
  - **召回率（Recall）**：衡量检索结果中包含的相关文档占所有相关文档的比例。
  - **精确率（Precision）**：衡量检索结果中相关文档的比例。
  - **命中数（Hit）**：判断检索结果中是否包含至少一个相关文档。
  - **平均倒数排名（MRR）**：衡量第一个相关文档在检索结果中的排名。
  - **归一化折损累积增益（NDCG）**：考虑了相关文档的排名顺序，更全面地评估检索结果的质量。
- **可视化**
  - 使用Matplotlib库绘制柱状图，直观地展示不同检索方式和融合策略的评估指标对比。

## 代码结构
```
.
├── config/
│   └── config.py
├── retrieval.py
├── evaluation.py
└── main_eval1.py
```

## 依赖库
- `os`：用于文件和目录操作。
- `json`：用于处理JSON数据。
- `logging`：用于记录程序运行日志。
- `jieba`：中文分词库。
- `whoosh`：全文搜索引擎。
- `sklearn`：机器学习库，用于计算TF-IDF分数。
- `langchain_ollama`：提供OllamaEmbeddings功能。
- `langchain`：向量存储和检索库。
- `matplotlib`：数据可视化库。
- `numpy`：科学计算库。

## 如何使用
1. 确保已经安装了所有依赖库。
2. 配置数据库和模型参数，修改`config/config.py`文件。
3. 运行`main_eval1.py`脚本，即可完成检索和评估，并生成可视化结果。

## 贡献
欢迎对本项目提出改进建议或提交代码贡献。如果发现任何问题或有新的功能需求，请在GitHub上提交Issue。

## 许可证
本项目采用[MIT许可证](https://opensource.org/licenses/MIT)。

## 评估指标详解

### 召回率（Recall）
- **定义**：检索结果中包含的相关文档占所有相关文档的比例。
- **公式**：$Recall = \frac{|\text{检索到的相关文档}|}{|\text{所有相关文档}|}$
- **评估逻辑**：召回率越高，说明检索系统能够找到更多的相关文档。当召回率为1时，表示检索系统找到了所有相关文档。

### 精确率（Precision）
- **定义**：检索结果中相关文档的比例。
- **公式**：$Precision = \frac{|\text{检索到的相关文档}|}{|\text{检索结果}|}$
- **评估逻辑**：精确率越高，说明检索结果中相关文档的比例越大。当精确率为1时，表示所有检索结果都是相关文档。

### 命中数（Hit）
- **定义**：判断检索结果中是否包含至少一个相关文档。
- **公式**：$Hit = \begin{cases} 1, & \text{如果检索结果中包含至少一个相关文档} \\ 0, & \text{否则} \end{cases}$
- **评估逻辑**：命中数是一个二值指标，用于快速判断检索系统是否能够找到至少一个相关文档。

### 平均倒数排名（Mean Reciprocal Rank, MRR）
- **定义**：衡量第一个相关文档在检索结果中的排名。
- **公式**：$MRR = \frac{1}{Q} \sum_{i=1}^{Q} \frac{1}{\text{rank}_i}$，其中$Q$是查询的数量，$\text{rank}_i$是第$i$个查询中第一个相关文档的排名。
- **评估逻辑**：MRR考虑了相关文档的排名位置，排名越靠前，MRR值越高。当所有查询的第一个相关文档都排在第一位时，MRR值为1。

### 归一化折损累积增益（Normalized Discounted Cumulative Gain, NDCG）
- **定义**：考虑了相关文档的排名顺序，更全面地评估检索结果的质量。
- **公式**：
  - **累积增益（CG）**：$CG@k = \sum_{i=1}^{k} rel_i$，其中$rel_i$是第$i$个检索结果的相关性得分。
  - **折损累积增益（DCG）**：$DCG@k = \sum_{i=1}^{k} \frac{rel_i}{\log_2(i+1)}$，通过对数函数对排名靠后的结果进行惩罚。
  - **理想折损累积增益（IDCG）**：$IDCG@k = \sum_{i=1}^{|REL|} \frac{rel_i}{\log_2(i+1)}$，其中$|REL|$是相关性得分最高的$k$个结果。
  - **归一化折损累积增益（NDCG）**：$NDCG@k = \frac{DCG@k}{IDCG@k}$
- **评估逻辑**：NDCG考虑了检索结果的相关性和排名顺序，能够更全面地评估检索系统的性能。当检索结果的排名与理想排名完全一致时，NDCG值为1。
